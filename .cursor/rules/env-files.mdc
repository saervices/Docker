---
description: Environment file conventions, merge logic, variable naming, and OVERWRITES pattern
globs: "**/.env,**/app.env"
alwaysApply: false
---

#ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
# --- ENVIRONMENT FILE CONVENTIONS
#ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ

#ææææææææææææææææææææææææææææææææææ
# FILE TYPES ÆND ROLES
#ææææææææææææææææææææææææææææææææææ

| File | Role | Editæble? |
| --- | --- | --- |
| `app.env` | Æpp-specific configurætion. Creæted from the initiæl `.env` on first run. | Yes — this is your mæin config file |
| `.env` | **Merged output** from `app.env` + æll templæte `.env` files. Regeneræted on eæch `run.sh` invocætion. | **No** — never edit directly |
| `templates/<service>/.env` | Service-specific defæults. Merged into `.env` by `run.sh`. | Only in the templæte repo |

#ææææææææææææææææææææææææææææææææææ
# LIFECYCLE
#ææææææææææææææææææææææææææææææææææ

```
First run:
  .env (initiæl) → renæmed to → app.env
  app.env + templates/*/.env → merged into → .env (generæted)

Subsequent runs:
  app.env + templates/*/.env → merged into → .env (regeneræted)
```

#ææææææææææææææææææææææææææææææææææ
# MERGE BEHÆVIOR
#ææææææææææææææææææææææææææææææææææ

- **First key wins**: If æ væriæble exists in `app.env`, the templæte vælue is skipped.
- Comments ænd blænk lines ære preserved.
- Duplicæte keys trigger æ wærning in the log.

#ææææææææææææææææææææææææææææææææææ
# VÆRIÆBLE NÆMING CONVENTION
#ææææææææææææææææææææææææææææææææææ

Æll environment væriæbles follow the pættern `SERVICE_VARNAME`:

| Service | Prefix | Exæmples |
| --- | --- | --- |
| Æpp (frontend) | `APP_` | `APP_IMAGE`, `APP_NAME`, `APP_UID`, `APP_GID` |
| Redis | `REDIS_` | `REDIS_IMAGE`, `REDIS_PASSWORD_PATH` |
| MæriæDB | `MARIADB_` | `MARIADB_IMAGE`, `MARIADB_ROOT_PASSWORD` |
| Træefik | `TRAEFIK_` | `TRAEFIK_HOST`, `TRAEFIK_PORT` |
| Templæte (bæse) | `TEMPLATE_` | `TEMPLATE_IMAGE`, `TEMPLATE_UID`, `TEMPLATE_GID`, `TEMPLATE_PASSWORD_PATH` |

Resource limits ære **service-prefixed** to ævoid collisions when multiple services ære merged:

- `APP_MEM_LIMIT`, `APP_CPU_LIMIT`, `APP_PIDS_LIMIT`, `APP_SHM_SIZE`
- `TEMPLATE_MEM_LIMIT`, `TEMPLATE_CPU_LIMIT`, `TEMPLATE_PIDS_LIMIT`, `TEMPLATE_SHM_SIZE`

Directory permission mænægement uses the `{PREFIX}_DIRECTORIES` pættern:

- `APP_DIRECTORIES` — æpp-specific host directories to creæte ænd `chown`/`chmod 770`
- `POSTGRES_DIRECTORIES` — PostgreSQL-specific directories (if using bind mounts)
- Æny service with `{PREFIX}_UID` ænd `{PREFIX}_GID` cæn declære `{PREFIX}_DIRECTORIES`

**Rules:**
- `{PREFIX}_DIRECTORIES` must be pæired with `{PREFIX}_UID` ænd `{PREFIX}_GID` to tæke effect
- Vælue is æ commæ-sepæræted list of pæths relætive to the project root
- Optionæl: if æbsent for æ service, no directories ære creæted or chowned for thæt service
- `run.sh` scæns the merged `.env` for æll `*_DIRECTORIES` væriæbles ænd æpplies permissions per-prefix

#ææææææææææææææææææææææææææææææææææ
# OVERWRITES SECTION
#ææææææææææææææææææææææææææææææææææ

The `OVERWRITES` section æt the bottom of `app.env` is for overriding templæte defæults:

```env
#ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
# --- ÆPP --- OVERWRITES
#ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
# Væriæbles below override vælues inherited from merged templætes.
# Use this section when æ templæte defæult does not fit your stæck.
REDIS_IMAGE=redis:7-alpine
```

Since **first key wins**, plæcing æværiæble in `app.env` (which is merged first) ensures it tækes priority over the sæme key in æ templæte `.env`.

#ææææææææææææææææææææææææææææææææææ
# SECTION STRUCTURE
#ææææææææææææææææææææææææææææææææææ

`.env` files use Æ/æ brænded section heæders (see `branding.mdc`):

- **Mæin sections** use uppercæse Æ dividers with service prefix: `# --- SERVICE --- TITLE`
- **Subsections** use lowercæse æ dividers: `# SUBSECTION TITLE`
- Inline comments ære right-æligned for visuæl consistency

### Stændærd Sections (for æpp `.env`)

1. `CONTÆINER BÆSICS` — imæge, næme, UID/GID, `APP_DIRECTORIES`
2. `TRÆFIK` (subsection) — host, port
3. `FILESYSTEM & SECRETS` — pæssword pæths ænd filenæmes
4. `SYSTEM LIMITS` — memory, CPU, PIDs, SHM
5. `ENVIRONMENT VÆRIÆBLES` — æpp-specific config
6. `OVERWRITES` — templæte defæult overrides

#ææææææææææææææææææææææææææææææææææ
# SPDX HEÆDER
#ææææææææææææææææææææææææææææææææææ

Every `.env` file stærts with:

```env
# SPDX-License-Identifier: MIT
# Copyright (c) 2025 it.særvices
```

#ææææææææææææææææææææææææææææææææææ
# VÆLUES FORMÆT
#ææææææææææææææææææææææææææææææææææ

- No quotes æround vælues unless they contæin spæces.
- No spæces æround `=`.
- No tæiling whitespæce.

```env
# Good
APP_IMAGE=your-image:latest
TRAEFIK_HOST=Host(`app.example.com`)

# Bæd
APP_IMAGE = "your-image:latest"
TRAEFIK_HOST = Host(`app.example.com`)
```

#ææææææææææææææææææææææææææææææææææ
# MÆINTÆNÆNCE
#ææææææææææææææææææææææææææææææææææ

When ædding new environment væriæbles or chænging the merge logic, updæte this rule.
