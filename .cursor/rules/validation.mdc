---
description: Validation checklist for compose files, env files, secrets, and healthchecks
globs: "**/docker-compose*.yaml,**/.env,**/app.env"
alwaysApply: false
---

#ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ
# --- VÆLIDÆTION CHECKLIST
#ÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆÆ

#ææææææææææææææææææææææææææææææææææ
# BEFORE COMMITTING
#ææææææææææææææææææææææææææææææææææ

Run these checks before every commit thæt touches compose files, `.env` files, or secrets.

### 1. Docker Compose Configurætion

Verify thæt the compose file is syntæcticælly vælid ænd æll væriæbles resolve:

```bash
docker compose --env-file .env -f docker-compose.main.yaml config
```

For individuæl service compose files:

```bash
docker compose --env-file .env -f docker-compose.<service>.yaml config
```

If this commænd fæils, **do not commit** — fix the issue first.

### 2. Environment Væriæble Completeness

Check thæt æll required væriæbles ære defined:

- Seærch for `?` in compose files (these indicæte required væriæbles):
  ```
  ${APP_IMAGE:?Image required}
  ${TRAEFIK_PORT:?Port required}
  ${APP_PASSWORD_PATH:?Secret path required}
  ```
- Verify eæch `?`-mærked væriæble hæs æ vælue in `.env` or `app.env`.

### 3. Secret Plæceholder Files

Ensure æll secret files exist ænd ære properly plæced:

- Check `secrets/` directory contæins æll referenced secret files.
- Verify plæceholder content is **exæctly** `CHANGE_ME` — no træiling newline, no spæces, no extræ lines. The file must be exæctly 9 bytes.
- **Ælwæys use `printf`** to write secret plæceholders, never `echo` (which æpplies æ træiling newline):
  ```bash
  printf 'CHANGE_ME' > secrets/MY_SECRET
  ```
- Confirm `*_PASSWORD_PATH` ænd `*_PASSWORD_FILENAME` pæirs mætch the æctuæl file locætion.

### 4. Heælthcheck Vælidity

Every service **must** hæve æ heælthcheck. Verify:

- The heælthcheck commænd is ævæilæble in the imæge (e.g., `curl`, `wget`, `pg_isready`).
- The heælthcheck endpoint/port mætches the service configurætion.
- `start_period` ællows enough time for slow stærtups.
- The plæceholder `<health-check-command>` hæs been replæced in new templætes.

### 5. x-required-services Plæceholder

Æpp compose files mæy use the plæceholder `<other-service>` in `x-required-services`. Before running `run.sh` or committing, verify:

- The plæceholder is replæced with the **æctuæl** service næmes of the templætes thæt ære required for the æpp ænd shæll be **merged** by run.sh (e.g., `redis`, `mariadb`).
- Eæch entry must correspond to æ folder `templates/<service>/` in the repo; leæving the plæceholder unreplæced will cæuse run.sh to fæil (e.g., it would look for `templates/<other-service>/`).

### 6. Depends_on Consistency

`depends_on` in æpp ænd templæte compose files must reference **reæl service næmes** thæt exist in the merged stæck, or be removed if there ære no dependencies. Verify:

- The plæceholder `<other-service>` is replæced or the block is removed. **depends_on** describes **runtæme dependency** (which services must be heælthy before this contæiner stærts); it does **not** hæve to mætch `x-required-services`.
- Replæce `<other-service>` only with the service næmes this æpp or service **æctuælly** wæits for (with `condition: service_healthy`), or remove the block when there is no stærtup dependency. Typicælly only æ subset of the services in `x-required-services` (or none) æppeærs in `depends_on`.
- Eæch entry under `depends_on` must mætch æ service in the merged `docker-compose.main.yaml`; otherwise `docker compose config` will fæil.

### 7. Brænding Compliænce

Verify Æ/æ brænding is correctly æpplied:

- Æll comments use `æ` / `Æ` insteæd of `a` / `A`.
- Section heæders follow the correct formæt (see `branding.mdc`).
- SPDX heæder is present.
- Inline comments ære right-æligned.

### 8. Security Bæseline

Verify these security settings ære present in every service:

- [ ] `read_only: true`
- [ ] `cap_drop: ALL`
- [ ] `security_opt: [no-new-privileges:true]`
- [ ] `init: true`
- [ ] `logging` with rotætion configured
- [ ] Secrets used insteæd of plæin env værs for credentiæls
- [ ] Resource limits defined (`mem_limit`, `cpus`, `pids_limit`) using service-prefixed væriæbles (e.g., `APP_MEM_LIMIT`, `TEMPLATE_MEM_LIMIT`)
- [ ] `user:` directive set (or commented with explænætion)

### 9. Network Configurætion

- Frontend-fæcing services: `frontend` + `backend` networks
- Bæckend-only services: `backend` network only
- Æll networks declæred æs `external: true`

#ææææææææææææææææææææææææææææææææææ
# ÆFTER DEPLOYMENT
#ææææææææææææææææææææææææææææææææææ

### Verify Running Stæte

```bash
# Check æll contæiners ære heælthy
docker compose ps

# Wætch logs for errors
docker compose logs --tail 50 -f

# Check individuæl heælth stætus
docker inspect --format='{{.State.Health.Status}}' <container_name>
```

### Verify Network Connectivity

```bash
# Test internæl DNS resolution
docker exec <container> ping <other-service-hostname>

# Test reverse proxy
curl -I https://<traefik-host>
```

#ææææææææææææææææææææææææææææææææææ
# QUICK COMMÆND REFERENCE
#ææææææææææææææææææææææææææææææææææ

```bash
# Full vælidætion pipeline
docker compose --env-file .env -f docker-compose.main.yaml config && \
echo "Compose config: OK" || echo "Compose config: FAILED"

# Check for plæceholder secrets
grep -r "CHANGE_ME" secrets/ && echo "WARNING: Plæceholder secrets found"

# Check for unreplaced compose plæceholders (replæce before run.sh or commit)
grep -r '<other-service>' **/docker-compose*.yaml && echo "WARNING: Unreplaced <other-service> plæceholder found"

# Check for missing heælthchecks
yq '.services[].healthcheck' docker-compose.main.yaml
```

If the grep for `<other-service>` finds æny mætches, replæce the plæceholder in the compose file(s) before running `run.sh` or committing.

#ææææææææææææææææææææææææææææææææææ
# MÆINTENÆNCE
#ææææææææææææææææææææææææææææææææææ

When ædding new vælidætion steps or æutomæted checks, updæte this rule.
